@model KCT.Models.Registration

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>Registration</h4>
<hr />

<form id="regForm">
    <div>
        <label> Name </label>
        <input type="text" class="form-control" id="name" />
    </div>
    <div class="mb-3">
        <label> Description </label>
        <input type="text" class="form-control" id="description" />
    </div>
    <div class="mb-3">
        <label> Address </label>
        <input type="text" class="form-control" id="address" />
    </div>
    <div class="mb-3">
        <label> City </label>
        <input type="text" class="form-control" id="city" />
    </div>
    <div class="mb-3">
        <label> Phone </label>
        <input type="text" class="form-control" id="phone" />
    </div>
    <button type="submit" class="btn btn-primary">Register</button>
</form>

<div class="table-container">
    <table id="itemsTable">

        <thead>
            <tr style="border:2px solid black">
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Address</th>
                <th>City</th>

            </tr>
        </thead>
        <tbody></tbody>


    </table>
</div>



<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    $("#regForm").on("submit", function (e) {
        e.preventDefault();
        const data = {
            name: $("#name").val(),
            description: $("#description").val(),
            address: $("#address").val(),
            city: $("#city").val(),
            phone: $("#phone").val()
        };
        console.log(data,"Done");

        $.ajax({
            url: "/Registration/Create",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(data)

        })
        .done(function (res) {
            console.log(res);
            alert(res.message || "Registered successfully!");
            $("#regForm")[0].reset();
         })

        .fail(function (xhr) {
            alert("Error: " + xhr.responseText);
        });

    });


    debugger
    function loadItems() {
         $.get("/Registration/GetAll", function(data) {
             const rows = data.map(item => `
                 <tr>
                     <td>${item.id}</td>
                     <td>${item.name}</td>
                     <td>${item.description}</td>
                     <td>${item.address}</td>
                     <td>${item.city}</td>
                     <td>
                         <button class="action-btn edit-btn" onclick="editItem(${item.id})">Edit</button>
                         <button class="action-btn delete-btn" onclick="deleteItem(${item.id})">Delete</button>
                     </td>
                 </tr>
             `);
             $("#itemsTable tbody").html(rows.join(""));
         });
     }
     loadItems();

      function editItem(id) {
        // Fetch the existing item data
        $.get(`/Registration/Get/${id}`, function(item) {
            // Fill the form with existing values
            $("#name").val(item.name);
            $("#description").val(item.description);
            $("#address").val(item.address);
            $("#city").val(item.city);
            $("#phone").val(item.phone);

            // Change form submit behavior to update
            $("#regForm").off("submit").on("submit", function(e) {
                e.preventDefault();

                const updatedData = {
                    name: $("#name").val(),
                    description: $("#description").val(),
                    address: $("#address").val(),
                    city: $("#city").val(),
                    phone: $("#phone").val()
                };

                $.ajax({
                    url: `/Registration/Edit/${id}`,
                    type: "PUT",
                    contentType: "application/json",
                    data: JSON.stringify(updatedData),
                    success: function(res) {
                        alert(res.message);
                        $("#regForm")[0].reset();
                        loadItems(); // refresh table
                        // Restore original submit to create new
                        setupCreateForm();
                    },
                    error: function(err) {
                        alert("Error updating registration: " + err.responseText);
                    }
                });
            });
        });
    }


        function deleteItem(id) {
        if (!confirm("Are you sure you want to delete this registration?")) return;

        $.ajax({
            url: `/Registration/Delete/${id}`,
            type: "DELETE",
            success: function(res) {
                alert(res.message);
                loadItems(); // refresh table
            },
            error: function(err) {
                alert("Error deleting registration: " + err.responseText);
            }
        });
    }


</script>
